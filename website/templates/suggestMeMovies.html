{% extends "base.html" %}
{% block content %}

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

<style>
	#suggestedMovie{
		margin-top: 20px;
    padding-bottom: 218px;
    width: 100%;
	}
	html{
  	height: 100%;
  	background: linear-gradient(to bottom right, #DF2D8C, #FF8870); background-repeat: no-repeat; background-size: 100% 100%;
  }
	body{
  	min-height: 100%;
  	background: linear-gradient(to bottom right,  #F75692, 40%, #FF8870); background-repeat: no-repeat; background-size: 100% 100%;
	}

	/*we can make the background to resize dynamically as the user zooms in or out*/
	.container{
		/*min-width: 100%;*/
	}

	#footer{
    right: 0; bottom: 0; left: 0;
    width: 100%;
    height: 218px;
  }
  #accordionExample{
    margin-bottom: 15px;
  }
  #headingOne, #headingTwo, #headingThree, #headingFour{
  	background: rgb(46,48,46);
  	font-weight: bold;
  }
	.card {
		width: 100%;
	}
  .btn{
  	color:white;
		padding: 10px;
		background: rgb(46,48,46);
		margin-bottom: 15px;
		border-color: rgb(46,48,46);
		border: 10px;
		width: 100%;
  }
	#movieSection{
		background: rgba(255,255,255,0.5);
		box-shadow: 5px 5px 22px grey;
		margin-top: 20px;
		margin-left: 20px;
	}
	#runtime {
		float: left;
	}
	#rating {
		float: right;
	}
	#filterSection{
		margin-top: 20px;
		margin-left: 20px;
	}
	#posterSection{
		margin-left: 30px;
	}
	#poster{
		display: block;
		margin-left: 0;
		margin-top: 0;
		width: 100%;
		height: 100%;
	}
  #trailer{
    display: block;
    margin-left: auto;
    margin-right: auto;
		margin-bottom: 20px;
		width: 100%;
  }

</style>
<div class="container-fluid" id="suggestedMovie">
	<div class="row">
		<!-- there is a fixed size of a poster set -->
		<!-- it probably needs to be dynamically resizable -->
		<!-- check bootstrap docs for image classes -->
		<div class="col-sm-3 pt-3 no-gutters" id="posterSection">
      {% if error_message %}
        <!-- just skip then and not output anything -->
      {% else %}
				<img src={{poster}} id="poster">
			{% endif %}
		</div>

		<div class="col-sm-6 pt-3 no-gutters" id="movieSection">
			<div class="col-sm-12 p-3" id="movieDetails">
				{% if error_message %}
	          <h2>{{ error_message }}</h2>
	      {% else %}
	          <h2><b><u>{{ movie_title}}  ({{ year_of_movie }})</u></b></h2>
	          <br>
						<div style="clear: both;">
		          <h4 id="runtime">Duration: {{runtime}}</h4>
		          <h4 id="rating">IMDB Rating: {{ rating }}</h4>
						</div>
	          <br> <br>
	          <h4>Language</h4>
	          {{language}}
	          <br> <br>
	         	<h4>Genres</h4>
	          {% for genre in genres %}
	          	{{genre}}
	          {% endfor %}
	          <br> <br>
	          <h4>Description</h4>
	          {{plot}}
	           <br> <br>
	          <h4>Directors</h4>
	          {{directors}}
	          <br> <br>
	          <h4>Actors</h4>
	          {{actors}}
	         	<br> <br>
	         	<h4>Awards</h4>
	        	{{awards}}
	         	<br> <br>
	      {% endif %}
			</div>
		</div>

		<div class="col-sm-2 no-gutters" id="filterSection">
			{% if error_message %}
        <!-- just skip then and not output anything -->
      {% else %}
				{% if trailer %}
					<iframe src="{{trailer}}" frameborder="0" width="350" height="300" allow="fullscreen" id="trailer"></iframe>
					<!-- <h4><a href="{{trailer}}">YT trailer</a></h4> -->
				{% endif %}
			{% endif %}

      <!-- form to add movie to white or blacklist -->
			<div class="row">
				<button type="submit" name="writereviewbtn" class="btn btn-primary" id="writereviewbtn">Write Review</button>
				<button type="submit" name="movieprofilebtn" class="btn btn-primary" id="movieprofilebtn"><a href="/detailedReview/ID={{movie_id}}">View Movie Profile</a></button>
			</div>

			<!-- pop-up window for movie filter -->
			<form action="suggestMeMovies" method="POST" id="formSuggestMovie">
				<div class="accordion" id="accordionExample">

					<div class="card">
					    <div class="card-header" id="headingOne">
					      <h2 class="mb-0">
					        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
					          <h3><b>Genres</b></h3>
					        </button>
					      </h2>
					    </div>
					     <!-- use class-"collapse show" to open the criteria box after refreshing the page-->
					    <div id="collapseOne" class="collapse" aria-labelledby="headingOne" >
					      <div class="card-body">
					        {% for i in range(number_of_different_genres//2) %}
					        	<div class="container">
					        		<div class="row">
					        			<div class=" col-6 ">
					        				<label for="{{names_of_genres[i]}}">{{names_of_genres[i]}}</label>
						        			<input type="checkbox" name="{{names_of_genres[i]}}" id="{{names_of_genres[i]}}" value="{{names_of_genres[i]}}" {{checked_genres[i]}} style="float:right"><br/>
					        			</div>
					        			<div class=" col-6 ">
					        				<label for="{{names_of_genres[i+number_of_different_genres//2]}}">{{names_of_genres[i+number_of_different_genres//2]}}</label>
						       				 <input type="checkbox" name="{{names_of_genres[i+number_of_different_genres//2]}}" id="{{names_of_genres[i+number_of_different_genres//2]}}" value="{{names_of_genres[i+number_of_different_genres//2]}}" {{checked_genres[i+number_of_different_genres//2]}} style="float:right"><br/>
					        			</div>
					        		</div>
					        	</div>
					    	{% endfor %}
					      </div>
					    </div>
					</div>


					<div class="card">
					    <div class="card-header" id="headingTwo">
					      <h2 class="mb-0">
					        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
					          <h3><b>Ratings</b></h3>
					        </button>
					      </h2>
					    </div>
					    <!-- use class-"collapse show" to open the criteria box after refreshing the page-->
					    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" >
					      <div class="card-body">
					      	{% for i in range(number_of_different_ratings) %}
		                      {% if ratings[i] == chosen_rating %}
		                      <label for="{{ratings_texts[i]}}">{{ratings_texts[i]}}</label>
		                      <input type="radio" name="Ratings" id="{{ratings_texts[i]}}" value="{{ratings[i]}}" checked style="float:right"><br/>
		                      {% else %}
		                      <label for="{{ratings_texts[i]}}">{{ratings_texts[i]}}</label>
		                      <input type="radio" name="Ratings" id="{{ratings_texts[i]}}" value="{{ratings[i]}}" style="float:right"><br/>
		                      {% endif %}
		                  {% endfor %}
					      </div>
					    </div>
					</div>


					<div class="card">
					    <div class="card-header" id="headingFour">
					      <h2 class="mb-0">
					        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
					          <h3><b>Languages</b></h3>
					        </button>
					      </h2>
					    </div>
					    <!-- use class-"collapse show" to open the criteria box after refreshing the page-->
					    <div id="collapseFour" class="collapse" aria-labelledby="headingFour" >
					      <div class="card-body">
					      	{% for i in range(number_of_different_languages) %}
		                      {% if languages_identifiers[i] == chosen_language %}
		                      <label for="{{languages_texts[i]}}">{{languages_texts[i]}}</label>
		                      <input type="radio" name="Languages" id="{{languages_texts[i]}}" value="{{languages_identifiers[i]}}" checked style="float:right"><br/>
		                      {% else %}
		                      <label for="{{languages_texts[i]}}">{{languages_texts[i]}}</label>
		                      <input type="radio" name="Languages" id="{{languages_texts[i]}}" value="{{languages_identifiers[i]}}" style="float:right"><br/>
		                      {% endif %}
		                  {% endfor %}
					      </div>
					    </div>
					</div>


					<div class="card">
					    <div class="card-header" id="headingThree">
					      <h2 class="mb-0">
					        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
					          <h3><b>Ranges of Years</b></h3>
					        </button>
					      </h2>
					    </div>
					    <!-- use class-"collapse show" to open the criteria box after refreshing the page-->
					    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" >
					      <div class="card-body">
					        {% for i in range(number_of_different_ranges_of_years) %}
						    	<label for="{{ranges_of_years_text[i]}}">{{ranges_of_years_text[i]}}</label>
						        <input type="checkbox" name="{{ranges_of_years_text[i]}}" id="{{ranges_of_years_text[i]}}" value="{{ranges_of_years_text[i]}}" {{checked_ranges_of_years[i]}} style="float:right"><br/>
					    	{% endfor %}
					      </div>
					    </div>
					</div>
				</div>
			</form>

      <form method="post" action="{{ url_for('movies.save_movie') }}" id="saveMovieForm">
      	<input type="hidden" name="currentMovieID" id="currentMovieID" value="{{ movie_id }}">
      	<input type="hidden" name="currentMovieTitle" id="currentMovieTitle" value="{{ movie_title }}">
      	<input type="hidden" name="currentMoviePoster" id="currentMoviePoster" value="{{ poster }}">
				<div class="row">
					<div class="col-md-3">
						<button form="saveMovieForm" type="submit" name="whitelistbtn" class="btn btn-primary" id="whitelistbtn">
		        	<i class="fa fa-heart" aria-hidden="true"></i>
		      	</button>
					</div>
					<div class="col-md-3">
						<button form="saveMovieForm" type="submit" name="blacklistbtn" class="btn btn-primary" id="blacklistbtn">
		        	<i class="fa fa-times" aria-hidden="true"></i>
		      	</button>
					</div>
					<div class="col-md-6">
						<button form="formSuggestMovie" type="submit" name="generatebtn" class="btn btn-primary" id="generatebtn">Generate!</button>
					</div>
				</div>
  		</form>
		</div>

	</div>
</div>
<!-- Script to deal with data without refreshing page -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
	//Checks if whitelist or blacklist was clicked
	var buttonpressed;
	var whitebtn = document.getElementById("whitelistbtn");
	var blackbtn = document.getElementById("blacklistbtn");
	$('.btn-primary').click(function() {
	    buttonpressed = $(this).attr('name')
	});

   $("#saveMovieForm").submit(function(e) {
       e.preventDefault();
       var form = $(this);
       var url = form.attr('action');
       var info = form.serialize() + '&buttonpressed=' + buttonpressed;

       $.ajax({
           type: "POST",
           url: url,
           data: info,
           context: form,
           success: function(resp) {
           		if (resp == "SavedW"){
           			whitebtn.style.color = "red"
           		} else if (resp == "SavedB"){
           			blackbtn.style.color = "black"
           		}else if (resp == "RemovedW"){
           			whitebtn.style.color = "white"
           		}else if (resp == "RemovedB"){
           			blackbtn.style.color = "white"
           		}else if (resp == "BtoW"){
           			whitebtn.style.color = "red"
           			blackbtn.style.color = "white"
           		}else if (resp == "WtoB"){
           			whitebtn.style.color = "white"
           			blackbtn.style.color = "black"
           		}else if (resp == "/login"){
					$(location).attr('href', resp)
           		}else{
           			alert("Something went wrong")
           		}
           }
       });
   });
</script>
{% endblock content %}
