{% extends "base.html" %}
{% block content %}

	<!-- Link to the animated background -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

	<!-- CSS styling, to be moved to static style file -->
	<style>
	html {
    height: 100%;
		background: linear-gradient(to bottom right, #DF2D8C, #FF8870); background-repeat: no-repeat; background-size: 100% 100%;
  	}
  body{
    min-height: 100%;
		background-size: 100%;
		background: linear-gradient(to bottom right,  #F75692, 40%, #FF8870); background-repeat: no-repeat; background-size: 100% 100%;
	}
	#mainBody {
		margin-top: 20px;
		margin-bottom: 40px;
		background-position: center;
		width: 90%;
		height: 80%;
		border-top-right-radius: 10px;
		border-top-left-radius: 10px;
		border-bottom-left-radius: 10px;
		border-bottom-right-radius: 10px;
		animation: fadein 1.5s;
	}
	#poster{
		display: block;
		margin-left: 0;
		margin-top: 0;
		width: 100%;
		height: 100%;
	}
	#movieDetails {
		background: rgba(255,255,255,0.5);
		box-shadow: 5px 5px 22px grey;
	}
	#runtime {
		float: left;
	}
	#rating {
		float: right;
	}
	#reviewsSection {
		background: rgba(255,255,255,0.5);
		box-shadow: 5px 5px 22px grey;
	}
	#footer{
    right: 0; bottom: 0; left: 0;
    width: 100%;
    height: 218px;
  }
	.btn{
		padding: 10px;
		color: white;
		background: rgb(46,48,46);
		margin-top: -15px;
		border-color: rgb(46,48,46);
		border: 10px;
		width: 200px;
	}
	#movieDetails::-webkit-scrollbar {
	    width: 5px;
	}
	#movieDetails::-webkit-scrollbar-track {
	    background: none;
	}
	#movieDetails::-webkit-scrollbar-thumb {
	    background-color: white;
	    border-radius: 20px;
	    border: none;
	}
	@keyframes fadein {
	  from { opacity: 0}
	  to   { opacity: 1}
	}

</style>

	<!-- FILM INFORMATION SECTION-->
	<div id="mainBody" class="container-fluid p-3">
		{% if not error_message %}
			<h3><u>{{movie_title}} ({{year_of_movie}})</u></h3>
		{% else %}
			<h2 class="m-2">{{error_message}}</h2>
		{% endif %}
		<div class="row">
			{% if not error_message %}
			<div class="col-md-3">
				<p><img src={{poster}} width="350" id="poster"></p>
				<div class="col-md-4">
					<button type="submit" name="writereviewbtn" class="btn btn-primary" data-toggle="modal" data-target='#write_reviews' id="writereviewbtn">Write Review</button>
				</div>
			</div>
			<div class="col-md-9" id="movieDetails" style="overflow-y:auto; height: 500px;">
				<br>
				<h3><u>MOVIE INFORMATION</u></h3>
				<div style="clear: both;">
					<p id="rating">Rating: {{imdb_rating}}</p>
					<p id="runtime">Duration: {{runtime}}</p>
				</div>
				<br> <br>
				<p>Language: {{language}}</p>
				<p>Genres: {{genres}}</p>
				<p>Awards: {{awards}}</p>
				<br>
				<h4><u>PLOT</u></h4>
				<p>{{plot}}</p>
				<br>
				<div class="row">
					<div class="col-md-3">
						<p><u>DIRECTORS</u></p>
						<p>{{directors}}</p>
					</div>
					<div class="col-md-3">
						<p><u>WRITERS</u></p>
						<p>{{writer}}</p>
					</div>
					<div class="col-md-3">
						<p><u>ACTORS</u></p>
						<p>{{actors}}</p>
					</div>
					<div class="col-md-3">
						<p><u>PRODUCTION</u></p>
						<p>{{production}}</p>
					</div>
				</div>
				<br>
				<form method="post" action="{{ url_for('movies.save_movie') }}" id="saveMovieForm">
					<input type="hidden" name="currentMovieID" id="currentMovieID" value="{{ movie_id }}">
					<input type="hidden" name="currentMovieTitle" id="currentMovieTitle" value="{{ movie_title }}">
					<input type="hidden" name="currentMoviePoster" id="currentMoviePoster" value="{{ poster }}">
					<div class="row">
						<div class="col-md-4">
							<div class="well text-center">
								<button form="saveMovieForm" type="submit" name="whitelistbtn" class="btn btn-primary" id="whitelistbtn">
				        	<i class="fa fa-heart" aria-hidden="true"></i>
				      	</button>
							</div>
						</div>
						<div class="col-md-4">
							<div class="well text-center">
								<button form="saveMovieForm" type="submit" name="blacklistbtn" class="btn btn-primary" id="blacklistbtn">
				        	<i class="fa fa-times" aria-hidden="true"></i>
				      	</button>
							</div>
						</div>
					</div>
				</form>
				<br>
			</div>
			<br>
			{% else %}
				<h2 class="m-2">{{error_message}}</h2>
			{% endif %}
		</div>
		<br>
		<div class="well text-center">

		</div>
		<!-- pop-up for reviews -->
		<form class="form-group form-group-lg" method="POST" action="">
			{{ form.hidden_tag() }}
		<div id="write_reviews" class="modal fade">
			<div class="modal-dialog modal-lg" role="dialog">
					<div class="modal-content">
							<div class="modal-header">
									<h4 class="modal-title text-xs-center">{{movie_title}} ({{year_of_movie}})</h4>
							</div>
							<div class="w-100 p-3 h-100 d-inline-block">
								<div class="form-group">
									<div class="col-xs-4">
										<fieldset class="form-group">
												{{ form.title.label}}
												{% if form.title.errors %}
														{{ form.title }}
														<div class="invalid-feedback">
															{% for error in form.title.errors %}
																	<span> {{ error}} </span>
															{% endfor %}
														</div>
														{% else %}
															{{ form.title}}
															{% endif %}
										</fieldset>
									</div>
								</div>
							</div>
							<div class="modal-body">
								<div class="form-group">
									<div class="col-xs-9">
										<fieldset class="form-group" id="exampleFormControlTextarea1" rows="3">
												{{ form.content.label}}
												{% if form.content.errors %}
														{{ form.content }}
														<div class="invalid-feedback">
															{% for error in form.content.errors %}
																	<span> {{ error}} </span>
															{% endfor %}
														</div>
														{% else %}
															{{ form.content}}
															{% endif %}
										</fieldset>
									</div>
								</div>
							</div>
							<div class="form-group">
									{{ form.submit_review(class="btn btn-outline-info")}}
							</div>

								</div><!-- /.modal-content -->
						</div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
			</form>

			<!-- REVIEWS SECTION -->
		{% if not error_message %}
		<div class="container-fluid padding" id="reviewsSection">
			<br>
			<h3><u>REVIEWS</u></h3>
			<!-- loop criteria to be replaced with for review in review
			where the reviews are returned from the DB -->
			{% for review in reviews%}
				<div>
					<div class="row">
						<div class="col-md-4">
							<h4>{{review.title}}</h4>
							<p>{{review.user_id}}</p>
						</div>
						<div class="col-md-8">
							<small>{{review.date.date()}}</small>
						</div>
					</div>
					<p>{{review.data}}</p>
				</div>
			{% endfor %}
		</div>
		{% endif %}
	</div>
	<br>

	<!-- Script to deal with data without refreshing page -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script>
		//Checks if whitelist or blacklist was clicked
		var buttonpressed;
		var whitebtn = document.getElementById("whitelistbtn");
		var blackbtn = document.getElementById("blacklistbtn");
		$('.btn-primary').click(function() {
		    buttonpressed = $(this).attr('name')
		});

	   $("#saveMovieForm").submit(function(e) {
	       e.preventDefault();
	       var form = $(this);
	       var url = form.attr('action');
	       var info = form.serialize() + '&buttonpressed=' + buttonpressed;

	       $.ajax({
	           type: "POST",
	           url: url,
	           data: info,
	           context: form,
	           success: function(resp) {
	           		if (resp == "SavedW"){
	           			whitebtn.style.color = "red"
	           		} else if (resp == "SavedB"){
	           			blackbtn.style.color = "black"
	           		}else if (resp == "RemovedW"){
	           			whitebtn.style.color = "white"
	           		}else if (resp == "RemovedB"){
	           			blackbtn.style.color = "white"
	           		}else if (resp == "BtoW"){
	           			whitebtn.style.color = "red"
	           			blackbtn.style.color = "white"
	           		}else if (resp == "WtoB"){
	           			whitebtn.style.color = "white"
	           			blackbtn.style.color = "black"
	           		}else if (resp == "/login"){
						$(location).attr('href', resp)
	           		}else{
	           			alert("Something went wrong")
	           		}
	           }
	       });
	   });
	</script>

{% endblock content %}
