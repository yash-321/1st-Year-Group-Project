{% extends "base.html" %}
{% block content %}

	<!-- Link to the animated background -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

	<!-- CSS styling, to be moved to static style file -->
	<style>
	html {
    height: 100%;
		background: linear-gradient(to bottom right, #DF2D8C, #FF8870); background-repeat: no-repeat; background-size: 100% 100%;
  	}
  body{
    min-height: 100%;
		background-size: 100%;
		background: linear-gradient(to bottom right,  #F75692, 40%, #FF8870); background-repeat: no-repeat; background-size: 100% 100%;
	}
	#mainBody {
		margin-top: 20px;
		margin-bottom: 40px;
		background-position: center;
		width: 90%;
		height: 80%;
		animation: fadein 1.5s;
	}
	#poster{
		display: block;
		margin-left: 0;
		margin-top: 0;
		width: 100%;
		height: 100%;
	}
	#movieDetails, #reviewsSection {
		background: rgba(255,255,255);
		box-shadow: 5px 5px 22px grey;
		border-top-left-radius: 10px;
		border-bottom-left-radius: 10px;
		border-top-right-radius: 10px;
		border-bottom-right-radius: 10px;
	}
	#runtime {
		float: left;
	}
	#rating {
		float: right;
	}
	#footer{
    right: 0; bottom: 0; left: 0;
    width: 100%;
    height: 218px;
  }
	.btn{
		padding: 10px;
		color: white;
		background: rgb(46,48,46);
		margin-top: 5px;
		border-color: rgb(46,48,46);
		border: 10px;
		width: 200px;
	}
	/* #movieDetails::-webkit-scrollbar {
	    width: 5px;
	}
	#movieDetails::-webkit-scrollbar-track {
	    background: none;
	}
	#movieDetails::-webkit-scrollbar-thumb {
	    background-color: grey;
	    border-radius: 20px;
	    border: none;
	} */
	span {
		font-size: 1.3em;
	}
	@keyframes fadein {
	  from { opacity: 0}
	  to   { opacity: 1}
	}
/*=====some font style =====*/
	h4{
		text-decoration: underline;
		color: #323232;
	}
	h3{
		margin-bottom: -10px;
		color: rgb(1, 39, 12);
		line-height: 1.5;
		font-size: 40px;
	}
	.rating{
		color:red;
	}
	.ltitle{
		color:#e011c5;
	}
	.reviews{
		font-size: 40px;
	}
/*======================*/
</style>

	<!-- FILM INFORMATION SECTION-->
	<div id="mainBody" class="container-fluid p-3">
		{% if not error_message %}
			<h3>{{movie_title}} ({{year_of_movie}})</h3>
		{% else %}
			<h2 class="m-2">{{error_message}}</h2>
		{% endif %}
		<br>
		<div class="row">
			{% if not error_message %}
			<div class="col-md-3">
				<span><img src={{poster}} width="350" id="poster"></span>
			</div>
			<div class="col-md-9" id="movieDetails">
				<br>
				<h4>MOVIE INFORMATION</h4>
				<div style="clear: both;">
					<span class ='rating'id="rating">Rating: {{imdb_rating}}</span>
					<span id="runtime">Duration: {{runtime}}</span>
				</div>
				<br> <br>
				<span>Language: {{language}}</span>
				<br>
				<span>Genres: {{genres}}</span>
				<br>
				<span>Awards: {{awards}}</span>
				<br>
				<br>
				<h4>PLOT</h4>
				<span>{{plot}}</span>
				<br><br><br>
				<div class="row">
					<div class="col-md-3">
						<span class='ltitle'>DIRECTORS</span>
						<br>
						<span>{{directors}}</span>
					</div>
					<div class="col-md-3">
						<span class='ltitle'>WRITERS</span>
						<br>
						<span>{{writer}}</span>
					</div>
					<div class="col-md-3">
						<span class='ltitle'>ACTORS</span>
						<br>
						<span>{{actors}}</span>
					</div>
					<div class="col-md-3">
						<span class='ltitle'>PRODUCTION</span>
						<br>
						<span>{{production}}</span>
					</div>
				</div>
				<br>
			</div>
			<br>
			{% else %}
				<h2 class="m-2">{{error_message}}</h2>
			{% endif %}
		</div>
		<br>

		<div class="row">
			<div class="col-md-3">
				<form method="post" action="{{ url_for('movies.save_movie') }}" id="saveMovieForm">
					<input type="hidden" name="currentMovieID" id="currentMovieID" value="{{ movie_id }}">
					<input type="hidden" name="currentMovieTitle" id="currentMovieTitle" value="{{ movie_title }}">
					<input type="hidden" name="currentMoviePoster" id="currentMoviePoster" value="{{ poster }}">
					<div class="well text-center">
						<button form="saveMovieForm" type="submit" name="whitelistbtn" style="color: {{whitebtn}}" class="btn btn-primary" id="whitelistbtn">
							<i class="fa fa-heart" aria-hidden="true"></i>
						</button>
						<button form="saveMovieForm" type="submit" name="blacklistbtn" style="color: {{blackbtn}}" class="btn btn-primary" id="blacklistbtn">
							<i class="fa fa-times" aria-hidden="true"></i>
						</button>
					</div>
				</form>
				<div class="well text-center">
					<button type="submit" name="writereviewbtn" class="btn btn-primary" data-toggle="modal" data-target='#write_reviews' id="writereviewbtn">Write Review</button>
				</div>
				<!-- write reviews pop up window -->
				<form class="form-group form-group-lg" method="POST" action="">
					{{ form.hidden_tag() }}
					<div id="write_reviews" class="modal fade">
						<div class="modal-dialog modal-lg" role="dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h4 class="modal-title w-100 text-center">{{movie_title}} ({{year_of_movie}})</h4>
									<button type="button" class="close" data-dismiss="modal">&times;</button>
								</div>
								<div class="modal-body">
									<div class="container">
									 <div class="row">
										 <div class="form-group">
											 <fieldset class="form-group">
												 <div class="col-md-3">
												 	{{ form.title.label}}
												 </div>
												 <div class="col-md-9">
													 {% if form.title.errors %}
														 {{ form.title }}
														 <div class="invalid-feedback">
															 {% for error in form.title.errors %}
															 		<span> {{ error}} </span>
															 {% endfor %}
														 </div>
													 {% else %}
														 {{ form.title}}
														 {% endif %}
												</div>
											 </fieldset>
										 </div>
									 </div>
								 	</div>
									<!-- <div class="w-100 p-3 h-100 d-inline-block"> -->
									<div class="container">
										<div class="row">
											<div class="form-group">
												<fieldset class="form-group" id="exampleFormControlTextarea1" rows="3">
													<div class="col-md-3">
														{{ form.content.label}}
													</div>
													<div class="col-md-9">
														{% if form.content.errors %}
															{{ form.content }}
															<div class="invalid-feedback">
																{% for error in form.content.errors %}
																		<span> {{ error}} </span>
																{% endfor %}
															</div>
														{% else %}
															{{ form.content}}
															{% endif %}
													</div>
												</fieldset>
											</div>
										</div>
									</div>
									<div class="container">
										<div class="row">
											<div class="col-md-3">
												<div class="form-group">
														{{ form.submit_review(class="btn btn-outline-info")}}
												</div>
											</div>
										</div>
									</div>
								</div>
							</div><!-- /.modal-content -->
						</div><!-- /.modal-dialog -->
					</div><!-- /.modal -->
				</form>
			</div>

			<!-- REVIEWS SECTION -->
			<div class="col-md-9 no-gutters">
				{% if not error_message %}
				<div class="container-fluid padding" id="reviewsSection">
					<br>
					<h4 class='reviews'>REVIEWS</h4>
					<!-- loop criteria to be replaced with for review in review
					where the reviews are returned from the DB -->
					{% for review in reviews%}
						<div>
							<div class="row">
								<div class="col-md-4">
									<h4>{{review.title}}</h4>
									<span>{{review.user_id}}</span>
								</div>
								<div class="col-md-8">
									<small>{{review.date.date()}}</small>
								</div>
							</div>
							<span>{{review.data}}</span>
						</div>
					{% endfor %}
				</div>
				{% endif %}
			</div>
		</div>
	</div>
	<br>

	<!-- Script to deal with data without refreshing page -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script>
		//Checks if whitelist or blacklist was clicked
		var buttonpressed;
		var whitebtn = document.getElementById("whitelistbtn");
		var blackbtn = document.getElementById("blacklistbtn");
		$('.btn-primary').click(function() {
		    buttonpressed = $(this).attr('name')
		});

	   $("#saveMovieForm").submit(function(e) {
	       e.preventDefault();
	       var form = $(this);
	       var url = form.attr('action');
	       var info = form.serialize() + '&buttonpressed=' + buttonpressed;

	       $.ajax({
	           type: "POST",
	           url: url,
	           data: info,
	           context: form,
	           success: function(resp) {
	           		if (resp == "SavedW"){
	           			whitebtn.style.color = "red"
	           		} else if (resp == "SavedB"){
	           			blackbtn.style.color = "black"
	           		}else if (resp == "RemovedW"){
	           			whitebtn.style.color = "white"
	           		}else if (resp == "RemovedB"){
	           			blackbtn.style.color = "white"
	           		}else if (resp == "BtoW"){
	           			whitebtn.style.color = "red"
	           			blackbtn.style.color = "white"
	           		}else if (resp == "WtoB"){
	           			whitebtn.style.color = "white"
	           			blackbtn.style.color = "black"
	           		}else if (resp == "/login"){
						$(location).attr('href', resp)
	           		}else{
	           			alert("Something went wrong")
	           		}
	           }
	       });
	   });
	</script>

{% endblock content %}
